var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;import n,{createContext as c,useContext as o,useState as s,useEffect as m}from"https://cdn.skypack.dev/pin/react@v17.0.1-yH0aYV1FOvoIPeKBbHxg/mode=imports,min/optimized/react.js";import i from"https://cdn.skypack.dev/pin/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/mode=imports,min/optimized/react-dom.js";import{M as u,u as p,F as d,f as y,B as E,S as v,R as f}from"./vendor.7bdb524c.js";import{G as b,P as g,B as h,c as A,p as N,s as w}from"./util.dcef7bcf.js";const k=c(),M=c(),_={score:null,player:1,current_player:1,players:{1:"AI","-1":"AI"},names:{1:"Agent #1","-1":"Agent #2"},last_move:null,turn_delay:4e3,board:new Array(3).fill(0).map((()=>new Array(3).fill(0).map((()=>new Array(3).fill(0).map((()=>new Array(3).fill(0))))))),acquired:new Array(3).fill(0).map((()=>new Array(3).fill(0)))},C={score:null,current_player:1,last_move:null,turn_delay:2e3,board:new Array(3).fill(0).map((()=>new Array(3).fill(0).map((()=>new Array(3).fill(0).map((()=>new Array(3).fill(0))))))),acquired:new Array(3).fill(0).map((()=>new Array(3).fill(0)))};function I({row:e,column:t,className:a,handleMove:r,winner:l}){const c=o(k);return n.createElement("table",{className:"box"},n.createElement("tbody",null,[...Array(3).keys()].map(((o,s)=>n.createElement("tr",{key:s},[...Array(3).keys()].map(((s,m)=>n.createElement("td",{key:m,className:a,onClick:()=>{if(!Object.values(c.players).every((e=>"AI"==e))&&null==l)return"available"!=a||0!=c.board[e][t][o][s]?r({error:"Invalid Move"}):c.player!=c.current_player?r({error:"Opponent's Turn"}):void r({R:e,C:t,r:o,c:s})}},n.createElement("div",{className:{1:"tic","-1":"tac",0:""}[c.board[e][t][o][s]]+(c.last_move&&c.last_move.R==e&&c.last_move.C==t&&c.last_move.r==o&&c.last_move.c==s?" animate":"")})))))))))}function S({scaled:e,sendToServer:t}){const a=o(k),{worker:r}=o(M);r.onerror=e=>console.error(e),r.onmessage=({data:{move:e}})=>f(e);const[l,c]=s(null),[i,u]=s(""),[p,d]=s(!1),[y,E]=s([]);m((()=>{p&&setTimeout((()=>d(!1)),2e3)}),[p]);const v=()=>{let e=[...a.acquired.map(((e,t)=>e.map(((e,a)=>0==e?[t,a]:null)))).flat().filter((e=>e))];if(null!=a.last_move){let{r:t,c:r}=a.last_move;e=0==a.acquired[t][r]?[[t,r]]:e}c(a.score),E(e),("AI"==a.players[`${a.player}`]&&a.current_player==a.player||"AI"==a.players[""+-1*a.player]&&a.current_player==-1*a.player)&&r.postMessage({context:a})},f=e=>{let{error:r,R:l,C:n,r:o,c:s}=e;if(r)return u(r),void d(!0);a.board[l][n][o][s]=a.current_player,a.last_move={R:l,C:n,r:o,c:s},a.acquired[l][n]=0!=a.acquired[l][n]?a.acquired[l][n]:b.isAcquired(a.board[l][n],a.current_player)?a.current_player:a.board[l][n].flat().includes(0)?0:2,a.score=b.isAcquired(a.acquired,a.current_player)?a.current_player:a.acquired.flat().some((e=>0==e))?null:0,c(a.score),null==a.score&&(a.current_player=-1*a.current_player),t&&t(a),null==a.score&&(E(0==a.acquired[o][s]?[[o,s]]:[...a.acquired.map(((e,t)=>e.map(((e,a)=>0==e?[t,a]:null)))).flat().filter((e=>e))]),Object.values(a.players).some((e=>"AI"==e))&&v())};return m(v,[a]),n.createElement("div",{className:e?"scale-board":""},n.createElement("div",{id:"header"},null==l?n.createElement(n.Fragment,null,n.createElement("span",{className:"tic "+(1==a.current_player?"current":"")},a.names[1])," vs ",n.createElement("span",{className:"tac "+(-1==a.current_player?"current":"")},a.names[-1])):n.createElement("span",{className:{1:"tic winner","-1":"tac winner",0:"draw"}[l],dangerouslySetInnerHTML:{__html:0==l?"Match Drawn":`<b>${a.names[`${l}`]}</b> is the winner`}})),n.createElement("table",{className:"main-board"},n.createElement("tbody",null,[...Array(3).keys()].map(((e,t)=>n.createElement("tr",{key:t},[...Array(3).keys()].map(((t,r)=>n.createElement("td",{key:r,className:{1:"tic","-1":"tac",0:y.find((a=>a[0]==e&&a[1]==t))&&null==l?"available":""}[a.acquired[e][t]]},n.createElement(I,{row:e,column:t,className:{1:"tic","-1":"tac",0:y.find((a=>a[0]==e&&a[1]==t))&&null==l?"available":""}[a.acquired[e][t]],winner:l,handleMove:f}))))))))),n.createElement("div",{className:"message "+(p?"show":"")},i))}function H(){return new Worker("/assets/AgentWorker.e86fcf25.js",{type:"module"})}function O({visible:e,setVisible:t,link:a}){const{worker:r,setWorker:l}=o(M),[c,i]=s("HUMAN"),[u,E]=s("AI"),[v,f]=s(!1),[b,A]=s(!1),N=p();return m((()=>{"AI"==c&&E("HUMAN"),"AI"==u&&i("HUMAN"),c==u&&"HUMAN"==c&&E("HUMAN2"),f("HUMAN2"==u)}),[c,u]),n.createElement("div",{className:"modal-overlay",style:{display:e?"block":"none"}},n.createElement("div",{className:"modal-container"},n.createElement("span",{className:"f-left"},"Player 1"),n.createElement("select",{className:"f-right",onChange:({target:{value:e}})=>i(e),value:c},n.createElement("option",{value:"AI"},"Computer"),n.createElement("option",{value:"HUMAN"},"You")),n.createElement("br",null),n.createElement("br",null),n.createElement("span",{className:"f-left"},"Player 2"),n.createElement("select",{className:"f-right",onChange:({target:{value:e}})=>E(e),value:u},n.createElement("option",{value:"AI"},"Computer"),n.createElement("option",{value:"HUMAN"},"You"),n.createElement("option",{value:"HUMAN2"},"Human")),n.createElement("br",null),n.createElement("br",null),v&&n.createElement(n.Fragment,null,n.createElement("p",{style:{textAlign:"left"}},"Share the link with your opponent"),n.createElement("div",null,n.createElement("input",{id:"link",className:"f-left",readOnly:!0,value:`${g}://${h}/${a}`}),n.createElement("button",{title:b?"Link copied":"Copy the link",className:"f-right inline",onClick:()=>{document.querySelector("#link").select(),document.execCommand("copy"),A(!0)}},n.createElement(d,{icon:y}))),n.createElement("br",null),n.createElement("br",null)),n.createElement("span",{className:"f-right"},n.createElement("button",{onClick:()=>t(!1)},"Cancel"),"    ",n.createElement("button",{onClick:()=>{r.terminate(),l(new H),t(!1),N.push(`/${a}`,{player1:c,player2:u})}},"Go")),n.createElement("br",null)))}function U(){const{worker:e}=o(M),[t,a]=s(!1),[r,l]=s(0),[c,m]=s(!1),[i,p]=s(Math.floor(9e5*Math.random())+1e5);return e.onerror=e=>console.error(e),e.onmessage=({data:{percentage:e}})=>{"done"==e?a(!0):l(100*e)},n.createElement("div",{style:{textAlign:"center"}},n.createElement("h2",null,"Ultimate Tic Tac Toe"),n.createElement("br",null),t?n.createElement(k.Provider,{value:_},n.createElement(S,{scaled:!0})):n.createElement("div",{style:{width:140,margin:"0 auto",textAlign:"center"}},n.createElement(u,{color:"#46d7ff",secondaryColor:"#FF5F5C",height:140,width:140,arialLabel:"loading"}),n.createElement("p",{style:{fontSize:12}},`Loading AI Agent (${r}%)`)),t&&n.createElement("div",null,n.createElement("a",{href:"#",onClick:()=>m(!0)},"Start Game"),n.createElement("br",null),n.createElement("br",null),n.createElement(O,{visible:c,setVisible:m,link:i})))}function j({visible:e,setVisible:t,gameid:a}){const[r,l]=s(""),[c,o]=s("");return n.createElement("div",{className:"modal-overlay",style:{display:e?"block":"none"}},n.createElement("div",{className:"modal-container",style:{width:"25%"}},n.createElement("span",{className:"f-left"},"Name"),n.createElement("br",null),n.createElement("input",{className:"f-left",placeholder:c,maxLength:10,value:r,onChange:({target:{value:e}})=>l(e)}),n.createElement("br",null),n.createElement("br",null),n.createElement("span",{className:"f-right"},n.createElement("button",{onClick:()=>{r?(localStorage.setItem(a,r),t(!1)):o("Enter a valid name")}},"Start")),n.createElement("br",null)))}function q(e){const[c,o]=s(!1),[i,u]=s(null),[p,d]=s(null),y=e.match.params.gameid,E=localStorage.getItem(y),v=localStorage.getItem("userid");return m((()=>{if(E)if(e.history.location.state){let{player1:t,player2:a}=e.history.location.state,r=Object.assign({},C,{roles:{[v]:1},players:{1:t,"-1":"HUMAN2"==a?"HUMAN":a}});r.names={1:"HUMAN"==t?E:"Computer","-1":"HUMAN"==a?E:"AI"==a?"Computer":""},"HUMAN2"!=a?(r.player="HUMAN"==t?1:-1,u(r)):fetch("/save-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gameid:y,game:r}),accept:"application/json"}).then(A).then(N).then((({result:e})=>{r.player=1,u(r)})).catch((e=>console.error(e)))}else fetch("/fetch-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gameid:y}),accept:"application/json"}).then(A).then(N).then((({result:e})=>{e?(v in e.roles||(e.roles[v]=-1,e.names[-1]=E),e.player=e.roles[v],u(e)):alert("Invalid URL")})).catch((e=>console.error(e)));else o(!0)}),[E]),m((()=>{i&&Object.values(i.players).every((e=>"HUMAN"==e))&&w(p,d,(e=>{"name"in e&&(i.names[""+-1*i.player]=e.name,e=i),e.player=i.player,e.names=i.names,u(((e,n)=>{for(var c in n||(n={}))a.call(n,c)&&l(e,c,n[c]);if(t)for(var c of t(n))r.call(n,c)&&l(e,c,n[c]);return e})({},e))}),(()=>p.send(JSON.stringify({register:y,name:E}))))}),[i,p]),n.createElement(n.Fragment,null,n.createElement(j,{visible:c,setVisible:o,gameid:y}),i&&n.createElement(k.Provider,{value:i},n.createElement(S,{sendToServer:e=>{Object.values(i.players).every((e=>"HUMAN"==e))&&p.send(JSON.stringify({gameid:y,context:e}))}})))}function T(){const[e,t]=s(new H);return m((()=>{localStorage.getItem("userid")||localStorage.setItem("userid",Math.floor(9e5*Math.random())+1e5)}),[]),n.createElement(M.Provider,{value:{worker:e,setWorker:t}},n.createElement(E,null,n.createElement(v,null,n.createElement(f,{exact:!0,path:"/",component:U}),n.createElement(f,{path:"/:gameid",component:q}))))}i.render(n.createElement(n.StrictMode,null,n.createElement(T,null)),document.getElementById("root"));
